<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="BongsaDAO">
	<!-- 목록보기 -->
	<select id="getBongsaList" parameterType="HashMap" resultType="bongsa">
		SELECT b.BS_NO, b.BS_TITLE, b.BS_CONTENT ,b.BS_GOAL_CNT,b.BS_SUCCESS_CNT,
           	 b.BS_NAME, round(((b.BS_SUCCESS_CNT / b.BS_GOAL_CNT)*100),0) bs_rate,b.bs_recruit_end,u.user_email
    	FROM BONGSA b,userinfo u
		<where>
			<!-- 지역별 검색 -->
	 		<if test="bs_region != null">
	 			bs_region = #{bs_region}  and b.user_no = u.user_no
	 		</if>
	 		<!-- 키워드 검색-->
		 	<if test="searchKeyword != null">
  				${searchCondition} like '%${searchKeyword}%'  and b.user_no = u.user_no
  			</if>
	 		<!--검색을 하지않았을때 기본 조인값-->
		 	<if test="searchKeyword == null and bs_region == null">
  				b.user_no = u.user_no
  			</if>
		</where> 
	ORDER BY BS_NO DESC

	</select>
	
	<!-- 미승인 목록 보기 -->
	<select id="getBsApprovalList" parameterType="HashMap" resultType="bongsa">
		SELECT b.BS_NO, b.BS_TITLE, b.BS_CONTENT ,b.BS_GOAL_CNT,b.BS_SUCCESS_CNT,
           	 b.BS_NAME, round(((b.BS_SUCCESS_CNT / b.BS_GOAL_CNT)*100),0) bs_rate,b.bs_recruit_end,u.user_email
    	FROM BONGSA b,userinfo u
		<where>
			<!-- 지역별 검색 -->
	 		<if test="bs_region != null">
	 			bs_region = #{bs_region}  and b.user_no = u.user_no
	 		</if>
	 		<!-- 키워드 검색-->
		 	<if test="searchKeyword != null">
  				${searchCondition} like '%${searchKeyword}%'  and b.user_no = u.user_no
  			</if>
	 		<!--검색을 하지않았을때 기본 조인값-->
		 	<if test="searchKeyword == null and bs_region == null">
  				b.user_no = u.user_no and b.bs_ing = '대기'
  			</if>
		</where> 
	ORDER BY BS_NO DESC

	</select>
	
	
	<!-- 봉사 상세페이지 가져오기 -->
	<select id="getBongsa" parameterType="bongsa" resultType="bongsa">
  		select BS_TITLE, BS_CONTENT, BS_NAME, 
  		BS_NO, BS_REGION, BS_PLACE, BS_IMG_CNT, 
  		BS_PHONE, BS_WORK_START, BS_SUCCESS_CNT, 
  		BS_WORK_END, BS_EMAIL, BS_IMG_NAME, 
  		BS_GOAL_CNT, USER_NO, BS_READ_CNT, 
  		USER_NO,
  		round(((BS_SUCCESS_CNT / BS_GOAL_CNT)*100),0) bs_rate
  		from BONGSA 
  		where bs_no=#{bs_no}
  	</select>
  	
  	<!-- 참여하기페이지 보여주기 -->
  	
  	
  	
  	
  	
  	
  	
  	
	
	
	
	
<!-- 	 <insert id="insertBongsa" parameterType="bongsa" > -->
<!--   		Insert Into bongsa (BS_NO, BS_TITLE, BS_CONTENT,  -->
<!--   		BS_REGIONBS_PLACE, BS_RECRUIT_START, BS_RECRUIT_END, BS_WORK_START,  -->
<!--   		BS_WORK_END, BS_GOAL_CNT, BS_SUCCESS_CNT, BS_ING, BS_NAME, BS_PHONE,  -->
<!--   		BS_EMAIL, BS_IMG_CNT, BS_IMG_NAME, BS_READ_CNT, USER_NO) -->
<!--   		values (BONGSA_PJ_SEQ.nextval, #{title}, #{writer}, #{content}, sysdate, 0) -->
<!--   	</insert> -->
	
	

  </mapper>